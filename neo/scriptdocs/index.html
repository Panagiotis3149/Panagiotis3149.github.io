<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Neo Docs</title>
    <link rel="icon" href="neo.png" type="image/svg+xml">
    <style>
        :root{
            --panel-bg: rgba(16,18,28,0.6);
            --panel-strong: rgba(20,22,34,0.9);
            --muted: #9aa3c7;
            --accent1: rgb(71,120,225);
            --accent2: rgb(97,93,178);
            --radius: 12px;
            --sidebar-w: 280px;
            --glass: rgba(255,255,255,0.03);
            --link-accent: rgb(71,120,225);
            --ext-link: rgb(97,93,178);
            --scroll-thumb: rgba(255,255,255,0.06);
            --scroll-shadow: rgba(0,0,0,0.6);
        }
        html,body{
            height:100%;
            margin:0;
            padding-top:96px;
            font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            color:#e6eef8;
            background: radial-gradient(circle at 50% 100%, var(--accent1) 0%, var(--accent2) 60%);
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
            scroll-behavior:smooth;
        }
        .app{ display:flex; height:calc(100vh - 96px); gap:20px; padding:20px; box-sizing:border-box; }
        .sidebar{
            width:var(--sidebar-w);
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));
            border-radius:var(--radius);
            padding:14px;
            box-shadow: 0 6px 24px rgba(2,6,23,0.6);
            display:flex;
            flex-direction:column;
            min-width:200px;
            max-width:36%;
            backdrop-filter: blur(6px) saturate(120%);
            min-height:0;
        }
        .topbar{ height:64px; display:flex; align-items:center; justify-content:space-between; gap:12px; padding:0 16px; border-radius:12px; background:var(--panel-strong); box-shadow: 0 6px 20px rgba(3,6,20,0.6); position:fixed; top:12px; left:20px; right:20px; z-index:1000; }
        .brand{ display:flex; align-items:center; gap:12px; }
        .brand img{ width:36px; height:36px; object-fit:contain; border-radius:8px; background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); }
        .brand .title{ font-weight:600; letter-spacing:0.2px; font-size:15px; }
        .search{ display:flex; align-items:center; gap:8px; width:420px; max-width:60vw; }
        .search input{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:var(--glass); color:var(--muted); outline:none; transition:all .12s ease; font-size:14px; }
        .search input:focus{ border-color:rgba(255,255,255,0.07); color:#e6eef8; box-shadow:0 4px 16px rgba(2,6,23,0.5); }
        .nav{ overflow:auto; padding:8px; margin-top:8px; display:flex; flex-direction:column; gap:6px; flex:1; min-height:0; }
        .section{ padding:6px 4px; border-radius:8px; overflow:visible; display:flex; flex-direction:column; gap:6px; }
        .separator{ font-weight:700; color:#dbe8ff; text-transform:uppercase; font-size:12px; padding:6px 8px; border-radius:6px; background:transparent; }
        .item{ padding:8px 10px; border-radius:8px; display:flex; align-items:center; gap:8px; cursor:pointer; color: #cfe0ff; font-size:14px; transition:background .08s ease, transform .06s ease; user-select:none; }
        .item:hover{ background:rgba(255,255,255,0.02); transform:translateY(-1px) }
        .item.active{ background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); box-shadow: inset 0 1px 0 rgba(255,255,255,0.02) }
        .content{ flex:1; border-radius:var(--radius); padding:18px; background:linear-gradient(180deg, rgba(4,6,16,0.45), rgba(4,6,16,0.6)); box-shadow: 0 10px 40px rgba(1,3,10,0.6); overflow:auto; min-height:0; }
        .header-row{ display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:18px; }
        .meta{ color:var(--muted); font-size:13px; }
        .card{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.14)); padding:12px; border-radius:12px; margin-bottom:12px; }
        .markdown{ color:#dbe8ff; line-height:1.6; font-size:15px; }
        .markdown h1{ font-size:28px; margin:10px 0 }
        .markdown h2{ font-size:22px; margin:10px 0 }
        .markdown h3{ font-size:18px; margin:10px 0 }
        .markdown p{ margin:8px 0; color:#cfe0ff }
        .markdown code{ background:rgba(255,255,255,0.03); padding:2px 6px; border-radius:6px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:13px }
        .markdown pre{ background:rgba(0,0,0,0.5); padding:12px; border-radius:10px; overflow:auto; }
        .markdown a{ background: linear-gradient(90deg, var(--accent1), var(--accent2)); -webkit-background-clip: text; background-clip: text; color: transparent; text-decoration:none; }
        .markdown a:hover{ text-decoration:underline }
        .markdown a.ext-link{ background: linear-gradient(90deg, var(--ext-link), var(--accent1)); -webkit-background-clip: text; background-clip:text; color:transparent; font-weight:600; }
        .markdown table{ border-collapse:collapse; width:100%; margin:12px 0; }
        .markdown th, .markdown td{ border:1px solid rgba(255,255,255,0.04); padding:8px 10px; text-align:left; vertical-align:top; }
        .markdown thead th{ color:#eaf4ff; background: rgba(255,255,255,0.02); font-weight:700; }
        .markdown ul{ padding-left:20px; margin:6px 0 }
        .hint{ padding:12px; border-radius:10px; margin:12px 0; font-weight:600; display:block }
        .hint.info{ background: linear-gradient(90deg, rgba(97,93,178,0.15), rgba(71,120,225,0.07)); border:1px solid rgba(71,120,225,0.13); color:#dbe8ff }
        .hint.warning{ background: linear-gradient(90deg, rgba(225,140,71,0.08), rgba(178,97,93,0.06)); border:1px solid rgba(225,140,71,0.12); color:#ffd7b2 }
        .empty{ display:flex; align-items:center; justify-content:center; height:60%; color:var(--muted); font-size:16px; }
        kbd.kbd{ background:rgba(255,255,255,0.03); padding:6px 8px; border-radius:6px; font-size:12px; color:var(--muted); border:1px solid rgba(255,255,255,0.02); }
        .markdown mark{ background: transparent; padding:0; }
        .markdown code{ white-space:pre-wrap }

        /* content-ref styles */
        .markdown a.content-ref{ color:transparent; background: linear-gradient(90deg, var(--accent2), var(--accent1)); -webkit-background-clip:text; background-clip:text; font-weight:600; text-decoration:none; }

        /* small special class for the {% code %} block to allow width handling */
        .code-block{ margin:8px 0; }
        .code-block[data-fullwidth="false"]{ max-width:900px; }

        /* custom scrollbar (webkit) */
        ::-webkit-scrollbar{ width:10px; height:10px; }
        ::-webkit-scrollbar-track{ background: transparent; }
        ::-webkit-scrollbar-thumb{ background: var(--scroll-thumb); border-radius:10px; box-shadow: 0 0 8px var(--scroll-shadow); border: 2px solid transparent; background-clip: padding-box; }
        .sidebar .nav::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.05); border-radius:8px; }
        .content::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.06); border-radius:8px; }
        *{ scrollbar-width: thin; scrollbar-color: var(--scroll-thumb) transparent; }
        .sidebar .nav{ padding-right:6px; }
        .content{ padding-right:6px; }
        .markdown pre{ overflow:auto; }
        @media (max-width:900px){ .sidebar{ display:none } .search{ width:220px } .app{ padding:12px; height:auto } }
    </style>
</head>
<body>
<div style="display:flex;flex-direction:column;gap:12px;padding:20px;">
    <div class="topbar" style="display:flex;align-items:center;gap:12px">
        <div class="brand" style="display:flex;align-items:center">
            <img src="neo.png" alt="neo">
            <div style="display:flex;flex-direction:column">
                <div class="title">Neo Docs</div>
                <div style="font-size:12px;color:var(--muted)">Neoclient Script Documentation</div>
            </div>
        </div>
        <div style="flex:1"></div>
        <div class="search" style="max-width:480px">
            <input id="topSearch" placeholder="Search docs (Ctrl+K)" aria-label="Search docs"/>
            <small class="kbd">Ctrl K</small>
        </div>
    </div>
</div>
<div class="app">
    <aside class="sidebar"></aside>
    <main class="content">
        <div class="header-row">
            <div>
                <div class="meta" id="currentPath">Pick a document</div>
            </div>
            <div class="meta" id="metaInfo"></div>
        </div>
        <div id="doc" class="markdown card">
            <div class="empty">No document loaded</div>
        </div>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    async function fetchText(path){
        try{
            const res = await fetch(path);
            if(!res.ok) throw new Error('nope');
            return await res.text();
        }catch(e){
            return null;
        }
    }

    function parseList(text){
        if(!text) return {};
        const lines = text.replace(/\r/g,'').split('\n');
        const sections = {};
        let cur = null;
        for(let raw of lines){
            const line = raw.trim();
            if(!line) continue;
            const m = line.match(/^<([A-Z0-9_ \-]+)>$/i);
            const mc = line.match(/^<\/([A-Z0-9_ \-]+)>$/i);
            if(m){ cur = m[1].trim(); sections[cur] = []; continue; }
            if(mc){ cur = null; continue; }
            if(cur){ sections[cur].push(line); }
        }
        return sections;
    }

    function prettifyName(fname){
        return fname
            .replace(/_/g, ' ')
            .replace(/\b\w/g, c => c.toUpperCase())
            .replace(/\.md$/i,'');
    }



    function createNav(sections){
        const sidebar = document.querySelector('.sidebar');
        sidebar.innerHTML = '';
        const nav = document.createElement('nav');
        nav.id = 'nav';
        nav.className = 'nav';
        nav.setAttribute('aria-label','Documentation navigation');
        for(const [sec,files] of Object.entries(sections)){
            const sdiv = document.createElement('div');
            sdiv.className = 'section';
            const h = document.createElement('div');
            h.className = 'separator';
            h.textContent = sec;
            sdiv.appendChild(h);
            files.forEach(fname=>{
                const it = document.createElement('div');
                it.className = 'item';
                it.setAttribute('data-fname', fname);
                it.textContent = prettifyName(fname);
                it.tabIndex = 0;
                it.onclick = ()=> loadFile(fname, it);
                it.onkeydown = (e)=>{ if(e.key==='Enter') loadFile(fname,it) };
                sdiv.appendChild(it);
            });
            nav.appendChild(sdiv);
        }
        sidebar.appendChild(nav);
    }

    function setActive(elem){
        document.querySelectorAll('.item').forEach(i=>i.classList.remove('active'));
        if(elem) elem.classList.add('active');
    }

    async function loadFile(fname, clickedElem){
        setActive(clickedElem);
        document.getElementById('currentPath').textContent = fname;
        const raw = await fetchText(fname);
        if(!raw){
            document.getElementById('doc').innerHTML = '<div class="empty">could not load ' + fname + ' ðŸ’€</div>';
            return;
        }
        const html = renderMarkdown(raw);
        document.getElementById('doc').innerHTML = html;
        location.hash = encodeURIComponent(fname);
    }

    function decodeNumericEntities(str){
        return str.replace(/&#x([0-9A-Fa-f]+);/g, (_,hex)=>String.fromCharCode(parseInt(hex,16)))
            .replace(/&#([0-9]+);/g, (_,dec)=>String.fromCharCode(parseInt(dec,10)));
    }

    function renderMarkdown(md){
        md = decodeNumericEntities(md || '');
        md = md.replace(/\r/g,'').replace(/\t/g,'    ');

        const hintToken = '___HINT_' + Math.random().toString(36).slice(2) + '___';
        const hints = [];
        md = md.replace(/\{\%\s*hint\s+style=("|')(.*?)\1\s*\%\}([\s\S]*?)\{\%\s*endhint\s*\%\}/gi,
            (_,qa,style,inner) => {
                const id = hintToken + hints.length;
                hints.push({style: style.toLowerCase(), content: inner.trim()});
                return id;
            });

        const refToken = '___REF_' + Math.random().toString(36).slice(2) + '___';
        const refs = [];
        md = md.replace(/\{\%\s*content-ref\s+url=("|')([^"']+)\1\s*\%\}([\s\S]*?)\{\%\s*endcontent-ref\s*\%\}/gi,
            (_,qa,url,inner) => {
                const id = refToken + refs.length;
                refs.push(`<a class="content-ref" href="${url}">${inner.trim()}</a>`);
                return id;
            });

        marked.setOptions({ gfm: true, breaks: false, headerIds: true, mangle: false });
        let html = marked.parse(md);

        html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, (m,text,url)=>{
            if(/^https?:\/\//i.test(url)) return `<a href="${url}" target="_blank" rel="noreferrer">${text}</a>`;
            return m;
        });

        hints.forEach((h,i)=>{
            const cls = h.style === 'warning' ? 'hint warning' : 'hint info';
            html = html.replace(hintToken + i, `<div class="${cls}">${renderMarkdown(h.content)}</div>`);
        });

        refs.forEach((r,i)=>{
            html = html.replace(refToken + i, r);
        });

        return html;
    }


    async function init(){
        const listText = await fetchText('list');
        const sections = parseList(listText);
        createNav(sections);
        const hash = decodeURIComponent(location.hash.replace(/^#/,''));
        if(hash){
            const item = Array.from(document.querySelectorAll('.item')).find(i=>i.textContent===hash);
            if(item) item.click();
            else if(document.querySelector('.item')) document.querySelector('.item').click();
        }else{
            if(document.querySelector('.item')) document.querySelector('.item').click();
        }
        const topSearch = document.getElementById('topSearch');
        async function filter(q){
            q = q.trim().toLowerCase();
            const items = Array.from(document.querySelectorAll('.item'));
            for(const it of items){
                const fname = it.getAttribute('data-fname'); // store actual file name
                if(!fname) continue;
                const text = await fetchText(fname);
                const show = !q || (text && text.toLowerCase().includes(q));
                it.style.display = show ? '' : 'none';
            }
        }
        let searchTimeout;
        topSearch.addEventListener('input', e=>{
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(()=> filter(e.target.value), 150);
        });

        window.addEventListener('keydown', (e)=>{
            if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k'){
                e.preventDefault();
                topSearch.focus();
                topSearch.select();
            }
        });
        document.addEventListener('click', e=>{
            if(e.target && e.target.classList && e.target.classList.contains('item')){
                setActive(e.target);
            }
        });
    }
    init();
</script>
</body>
</html>
